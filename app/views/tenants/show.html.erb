<div class="page-header">
  <h1 class="header-title">Tenant: <%= @tenant.name %></h1>
  <div class="header-actions">
    <%= link_to "Edit Tenant", edit_tenant_path(@tenant), class: "btn btn-outline" %>
    <%= link_to "Back to Tenants", tenants_path, class: "btn btn-outline" %>
  </div>
</div>

<div class="row">
  <div class="col-md-8">
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">Tenant Details</h2>
      </div>
      <div class="card-body">
        <div class="detail-grid">
          <div class="detail-item">
            <div class="detail-label">Name</div>
            <div class="detail-value"><%= @tenant.name %></div>
          </div>
          
          <div class="detail-item">
            <div class="detail-label">Phone</div>
            <div class="detail-value"><%= @tenant.phone %></div>
          </div>
          
          <div class="detail-item">
            <div class="detail-label">Email</div>
            <div class="detail-value"><%= @tenant.email %></div>
          </div>
          
          <div class="detail-item">
            <div class="detail-label">ID Number</div>
            <div class="detail-value"><%= @tenant.id_number %></div>
          </div>
          
          <div class="detail-item">
            <div class="detail-label">Move-in Date</div>
            <div class="detail-value"><%= @tenant.move_in_date.strftime("%B %d, %Y") %></div>
          </div>
        </div>
      </div>
    </div>

    <div class="card mt-4">
      <div class="card-header">
        <h2 class="card-title">Room Assignment History</h2>
      </div>
      <div class="card-body">
        <% if @room_assignments.any? %>
          <table class="data-table">
            <thead>
              <tr>
                <th>Room</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% @room_assignments.each do |assignment| %>
                <tr>
                  <td><%= link_to assignment.room.number, room_path(assignment.room) %></td>
                  <td><%= assignment.start_date.strftime("%b %d, %Y") %></td>
                  <td>
                    <%= assignment.end_date ? assignment.end_date.strftime("%b %d, %Y") : "Current" %>
                  </td>
                  <td>
                    <span class="status-badge status-<%= assignment.active? ? 'active' : 'inactive' %>">
                      <%= assignment.active? ? "Active" : "Inactive" %>
                    </span>
                  </td>
                  <td>
                    <%= link_to "View", room_assignment_path(assignment), class: "btn btn-sm btn-outline" %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        <% else %>
          <div class="empty-state">
            <p>No room assignments found for this tenant.</p>
          </div>
        <% end %>
        
        <div class="card-actions mt-3">
          <%= link_to "Assign to Room", new_room_assignment_path(tenant_id: @tenant.id), class: "btn btn-primary" %>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-md-4">
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">Current Room</h2>
      </div>
      <div class="card-body">
        <% if @current_room %>
          <div class="room-info">
            <h3 class="room-number">Room <%= @current_room.number %></h3>
            
            <div class="detail-item">
              <div class="detail-label">Floor</div>
              <div class="detail-value"><%= @current_room.floor %></div>
            </div>
            
            <div class="detail-item">
              <div class="detail-label">Area</div>
              <div class="detail-value"><%= @current_room.area %> mÂ²</div>
            </div>
            
            <div class="detail-item">
              <div class="detail-label">Monthly Rent</div>
              <div class="detail-value">
                <%= number_to_currency(@current_room.monthly_rent, precision: 0, delimiter: ',', unit: 'VND ') %>
              </div>
            </div>
            
            <div class="card-actions">
              <%= link_to "View Room", room_path(@current_room), class: "btn btn-sm btn-outline" %>
            </div>
          </div>
        <% else %>
          <div class="empty-state">
            <p>This tenant is not currently assigned to any room.</p>
            <%= link_to "Assign to Room", new_room_assignment_path(tenant_id: @tenant.id), class: "btn btn-primary" %>
          </div>
        <% end %>
      </div>
    </div>
    
    <% if @current_room %>
      <div class="card mt-4">
        <div class="card-header">
          <h2 class="card-title">Recent Bills</h2>
        </div>
        <div class="card-body">
          <% active_assignment = @tenant.room_assignments.find_by(active: true) %>
          <% if active_assignment && active_assignment.bills.any? %>
            <% recent_bills = active_assignment.bills.order(billing_date: :desc).limit(3) %>
            <table class="data-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Amount</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <% recent_bills.each do |bill| %>
                  <tr>
                    <td><%= bill.billing_date.strftime("%b %d") %></td>
                    <td>
                      <%= number_to_currency(bill.total_amount, precision: 0, delimiter: ',', unit: 'VND ') %>
                    </td>
                    <td>
                      <span class="status-badge status-<%= bill.status %>">
                        <%= bill.status.capitalize %>
                      </span>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
            
            <div class="card-actions mt-3">
              <%= link_to "View All Bills", bills_path(tenant_id: @tenant.id), class: "btn btn-sm btn-outline" %>
              <%= link_to "Create New Bill", new_bill_path(tenant_id: @tenant.id), class: "btn btn-sm btn-primary" %>
            </div>
          <% else %>
            <div class="empty-state">
              <p>No recent bills found for this tenant.</p>
              <% if active_assignment %>
                <%= link_to "Create Bill", new_bill_path(room_assignment_id: active_assignment.id), class: "btn btn-primary" %>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>
