<div class="page-header">
  <% if @tenant %>
    <h1 class="header-title"><%= t('vehicles.title_for_tenant', tenant: @tenant.name) %></h1>
    <div class="header-actions">
      <%= link_to t('vehicles.new'), new_tenant_vehicle_path(@tenant), class: "btn btn-primary" %>
      <%= link_to t('common.back'), tenant_path(@tenant), class: "btn btn-outline" %>
    </div>
  <% else %>
    <h1 class="header-title"><%= t('vehicles.title') %></h1>
    <div class="header-actions">
      <%= link_to t('vehicles.new'), new_vehicle_path, class: "btn btn-primary" %>
    </div>
  <% end %>
</div>

<div class="card mb-4">
  <div class="card-body">
    <%= form_with url: @tenant ? tenant_vehicles_path(@tenant) : vehicles_path, method: :get, class: "search-form" do |form| %>
      <div class="input-group">
        <%= form.text_field :search, value: @search_query, class: "form-control", placeholder: t('vehicles.search_placeholder') %>
        <% unless @tenant %>
          <%= form.select :room_id, 
                        options_for_select([['', '']] + @rooms.map { |r| [r.number, r.id] }, @room_filter), 
                        { prompt: t('vehicles.filter_by_room') },
                        class: "form-select custom-room-filter" %>
        <% end %>
        <button type="submit" class="btn btn-primary custom-search-button">
          <i class="fas fa-search me-1"></i><span class="btn-text"><%= t('common.search') %></span>
        </button>
        <% if @search_query.present? || @room_filter.present? %>
          <% if @tenant %>
            <%= link_to tenant_vehicles_path(@tenant), class: "btn btn-outline custom-clear-button" do %>
              <i class="fas fa-times me-1"></i><%= t('common.clear') %>
            <% end %>
          <% else %>
            <%= link_to vehicles_path, class: "btn btn-outline custom-clear-button" do %>
              <i class="fas fa-times me-1"></i><%= t('common.clear') %>
            <% end %>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <% if @vehicles.any? %>
      <% if @search_query.present? || @room_filter.present? %>
        <div class="search-results-info mb-3">
          <% if @search_query.present? && @room_filter.present? %>
            <%= t('vehicles.search_and_filter_results', count: @vehicles.count, query: @search_query, room: Room.find(@room_filter).number) %>
          <% elsif @search_query.present? %>
            <%= t('vehicles.search_results', count: @vehicles.count, query: @search_query) %>
          <% elsif @room_filter.present? %>
            <%= t('vehicles.filter_results', count: @vehicles.count, room: Room.find(@room_filter).number) %>
          <% end %>
        </div>
      <% end %>
      <div class="table-responsive">
        <table class="data-table">
          <thead>
            <tr>
              <th><%= t('vehicles.license_plate') %></th>
              <th><%= t('vehicles.vehicle_type') %></th>
              <th><%= t('vehicles.brand') %></th>
              <th><%= t('vehicles.model') %></th>
              <th><%= t('vehicles.color') %></th>
              <% unless @tenant %>
                <th><%= t('vehicles.tenant') %></th>
                <th><%= t('vehicles.room') %></th>
              <% else %>
                <th><%= t('vehicles.room') %></th>
              <% end %>
              <th><%= t('common.actions') %></th>
            </tr>
          </thead>
          <tbody>
            <% @vehicles.each do |vehicle| %>
              <tr>
                <td><strong><%= vehicle.license_plate %></strong></td>
                <td><span class="vehicle-type-badge <%= vehicle.vehicle_type %>">
                  <%= t("vehicles.types.#{vehicle.vehicle_type}", default: vehicle.vehicle_type) %>
                </span></td>
                <td><%= vehicle.brand %></td>
                <td><%= vehicle.model %></td>
                <td><%= vehicle.color %></td>
                <% unless @tenant %>
                  <td><%= link_to vehicle.tenant.name, tenant_path(vehicle.tenant) %></td>
                  <td>
                    <% active_assignment = vehicle.tenant.room_assignments.find_by(active: true) %>
                    <% if active_assignment %>
                      <%= link_to active_assignment.room.number, room_path(active_assignment.room) %>
                    <% else %>
                      <span class="text-muted"><%= t('vehicles.no_room') %></span>
                    <% end %>
                  </td>
                <% else %>
                  <td>
                    <% active_assignment = vehicle.tenant.room_assignments.find_by(active: true) %>
                    <% if active_assignment %>
                      <%= link_to active_assignment.room.number, room_path(active_assignment.room) %>
                    <% else %>
                      <span class="text-muted"><%= t('vehicles.no_room') %></span>
                    <% end %>
                  </td>
                <% end %>
                <td>
                  <div class="d-flex align-items-center justify-content-end gap-2">
                    <%= link_to t('common.edit'), edit_vehicle_path(vehicle), class: "btn btn-sm btn-outline" %>
                    <%= button_to t('common.delete'), vehicle_path(vehicle), 
                          method: :delete,
                          form: { data: { turbo_confirm: t('vehicles.confirm_delete') }, class: "d-inline-block m-0" },
                          class: "btn btn-sm btn-outline" %>
                  </div>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <div class="empty-state">
        <i class="fas fa-car fa-3x mb-3"></i>
        <% if @tenant %>
          <p><%= t('vehicles.no_vehicles_for_tenant') %></p>
          <%= link_to t('vehicles.add_first'), new_tenant_vehicle_path(@tenant), class: "btn btn-primary" %>
        <% else %>
          <p><%= t('vehicles.no_vehicles') %></p>
          <%= link_to t('vehicles.add_first'), new_vehicle_path, class: "btn btn-primary" %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>

<style>
  .vehicle-type-badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 16px;
    font-size: 12px;
    font-weight: 600;
    text-align: center;
  }
  
  .vehicle-type-badge.car {
    background-color: #e3f2fd;
    color: #1976d2;
  }
  
  .vehicle-type-badge.motorcycle {
    background-color: #fce4ec;
    color: #e91e63;
  }
  
  .vehicle-type-badge.bicycle {
    background-color: #e8f5e9;
    color: #4caf50;
  }
  
  .vehicle-type-badge.scooter {
    background-color: #fff3e0;
    color: #ff9800;
  }
  
  .vehicle-type-badge.other {
    background-color: #f5f5f5;
    color: #9e9e9e;
  }

  /* Search form styling */
  .search-form {
    margin-bottom: 0;
  }

  .search-form .input-group {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .search-form .form-control {
    border-radius: 4px;
    height: 40px;
    flex: 3;
  }

  .custom-search-button {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    border-radius: 4px;
    height: 40px;
    min-width: 110px;
    justify-content: center;
  }

  .custom-clear-button {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    border-radius: 4px;
    height: 40px;
    min-width: 100px;
    justify-content: center;
    margin-left: 10px;
  }

  .custom-room-filter {
    border-radius: 4px;
    height: 40px;
    width: 160px;
    max-width: 160px;
    flex: 1;
  }

  .search-results-info {
    color: #6c757d;
    font-size: 0.9rem;
  }
  
  /* Action buttons styling */
  .btn-sm {
    min-width: 70px;
    text-align: center;
  }
  
  /* Fix for button_to form */
  form.d-inline-block {
    display: inline-block;
    margin: 0;
  }
</style>
